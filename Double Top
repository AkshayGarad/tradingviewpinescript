// Define the lookback period
lookback = 20

// Define the peak threshold
threshold = 0.02

// Get the highest high over the lookback period
highestHigh = highest(high, lookback)

// Calculate the distance between the current high and the highest high
distance = (highestHigh - high) / highestHigh

// Check if the current bar is a double top
if (distance <= threshold) and (distance[1] <= threshold)
    // Draw a double top pattern
    plotshape(shape=shape.arrowdown, color=color.red, location=location.belowbar, size=size.large)
    alert("Double Top Pattern!")
