// MACD & Stochastic RSI Buy/Sell Signals
study("MACD & Stochastic RSI Buy/Sell Signals", overlay=true)

// Define the parameters
fast_length = 12
slow_length = 26
macd_length = 9
rsi_length = 14
stoch_length = 14

// Calculate the indicators
macd = ema(close, fast_length) - ema(close, slow_length)
signal = ema(macd, macd_length)
rsi = rsi(close, rsi_length)
k = sma(stoch(close, high, low, stoch_length), 3)
d = sma(k, 3)

// Plot the indicators
plot(macd, color=color.blue, linewidth=2)
plot(signal, color=color.red, linewidth=2)

// Plot the histogram
plot(macd - signal, color=color.green, histogram=true, linewidth=2)

// Add a second RSI plot
plot(rsi, color=color.yellow, secondary=true)

//Add Stochastic RSI Plot
plot(k, color=color.green)
plot(d, color=color.red)

// Buy and Sell Signals
// MACD buy signal
buy = crossover(macd, signal)
// MACD sell signal
sell = crossunder(macd, signal)

// RSI buy signal
rsiBuy = rsi < 20
// RSI sell signal
rsiSell = rsi > 80

// Stochastic RSI buy signal
kBuy = crossunder(k, d)

// Stochastic RSI sell signal
kSell = crossover(k, d)

// Plot the buy and sell signals
plotshape(buy, style=shape.triangleup, color=color.green, location=location.belowbar)
plotshape(sell, style=shape.triangledown, color=color.red, location=location.abovebar)
plotshape(rsiBuy, style=shape.triangleup, color=color.green, location=location.bottom)
plotshape(rsiSell, style=shape.triangledown, color=color.red, location=location.bottom)
plotshape(kBuy, style=shape.triangleup, color=color.green, location=location.bottom)
plotshape(kSell, style=shape.triangledown, color=color.red, location=location.bottom)

// Add a legend
legend(title="MACD & Stochastic RSI Buy/Sell Signals", position=position.top)
